apiVersion: apps/v1
kind: Deployment
metadata:
    name: api-gateway
    namespace: blog-app
spec:
    replicas: 1
    selector:
        matchLabels:
            app: api-gateway
    template:
        metadata:
            labels:
                app: api-gateway
        spec:
            containers:
                - name: api-gateway
                  image: api-gateway:latest
                  imagePullPolicy: Never
                  ports:
                      - containerPort: 8080
                  env:
                      - name: PORT
                        value: "8080"
                      - name: AUTH_SERVICE_URL
                        valueFrom:
                            configMapKeyRef:
                                name: blog-config
                                key: AUTH_SERVICE_URL
                      - name: BLOG_SERVICE_URL
                        valueFrom:
                            configMapKeyRef:
                                name: blog-config
                                key: BLOG_SERVICE_URL
                      - name: JWT_ACCESS_SECRET
                        valueFrom:
                            {
                                secretKeyRef:
                                    {
                                        name: blog-secrets,
                                        key: JWT_ACCESS_SECRET,
                                    },
                            }
                      - name: JWT_REFRESH_SECRET
                        valueFrom:
                            {
                                secretKeyRef:
                                    {
                                        name: blog-secrets,
                                        key: JWT_REFRESH_SECRET,
                                    },
                            }
                      - name: FRONTEND_URL
                        valueFrom:
                            {
                                configMapKeyRef:
                                    { name: blog-config, key: FRONTEND_URL },
                            }
                      - name: NODE_ENV
                        valueFrom:
                            {
                                configMapKeyRef:
                                    { name: blog-config, key: NODE_ENV },
                            }
---
apiVersion: v1
kind: Service
metadata:
    name: api-gateway
    namespace: blog-app
spec:
    type: LoadBalancer
    selector:
        app: api-gateway
    ports:
        - protocol: TCP
          port: 8080
          targetPort: 8080
